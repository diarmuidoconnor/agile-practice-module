## Demo App 2

Recall the Employee Management API project. It was based on the Node and Express platform and is integrated with a Postgres database. Import the project into VS Code, and in the base folder, create a file called `Dockerfile` and add the following set of instructions:
~~~txt
FROM node:20-alpine

ENV PORT=5000 \
    DB_USER='postgres' \
    DB_HOST='' \
    DB_NAME='postgres' \
    DB_PASSWORD='' \
    DB_PORT=5432

EXPOSE 5000

RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

COPY . .
RUN npm install

CMD ["node", "index.js"]
~~~
Use the above file to build a Docker image of the app:
~~~bash
$ docker build -t employee-app:1.0 .
~~~
Start all the containers that make up this application's architecture:
~~~bash
$ docker rm -vf $(docker ps -aq)      (Clean up - Optiona.)
$ docker run -d  --name postgresDB  \
    --network mongo-network  \
    -p 5432:5432 \
    -e POSTGRES_PASSWORD=pass1234  \
    -e POSTGRES_DB=postgres  \
   postgres:13

$ docker run -d --name pgadmin4  \
    --network mongo-network \
    -p 5050:80  \
    -e PGADMIN_DEFAULT_EMAIL=admin@email.com \
    -e PGADMIN_DEFAULT_PASSWORD=pass5678  \
   dpage/pgadmin4:8.7

$ docker run -d --name employee --network mongo-network \
    -e DB_HOST=postgresDB \
    -e DB_PASSWORD=pass1234 \
    -p 4000:5000 \
   employee-app:1.0
~~~
Some points to note from above:

1. The containers are attached to the same Docker-managed network. We reused the custom network created in an earlier lab (mongo-network) for convenience.
1. Because the custom network supports DNS name resolution, the Web API can communicate with the database server using the latter's container name as a domain name. We enabled this by setting the DB_HOST environment variable of the API container to the container name of the Postgres database container. 

You now need to initialising the Postgres database using the PGAdmin tool running at http://localhost:5050. The steps are as follows:

1. Open a web browser tab at http://localhost:5050.
1. Log in to the app using the credentials we specified when starting the PGAdmin container, i.e., Email = admin@email.com and Password = pass5678.
1. Click the Add New Server link in the Quick Links section of the web page.
1. Enter EmployeeMgt as the server's name (arbitrary).
1. Select the Connection tab at the top.
1. Enter the IP address of the Postgres container as the Host Name/address (Use the shell command `docker inspect postgresDB' to get the container's IP address).
1. Enter postgres as the username.
1. Enter pass1234 as the password.
1. Click the Save button.

A new server called EmployeeMgt should appear in the left panel of the web page. Expand this server and expand its Databases list. There is one database called postgres, which we want to initialize. Right-click the postgres database and select Query Tool. In the Query text box that appears on the right, copy the SQL statements from the `script.sql` file in the VS Code project, and click the Execute Script icon. This has created three tables in the database: employee, employee-assignment, and teams. To confirm this, on the left panel expand Databases --> postgres --> Schemas --> Public --> Tables.   ``

You can now test the Employee web API that's running in a container by opening a browser tab at http://localhost:4000/api-docs/. This Web API has excellent inbuilt documentation generated by the [Swagger framework][swg] - not really a part of this module's focus. To view it, open a new browser tab at http://localhost:5000/api-docs/. Follow these steps to test the API:

1. Click the POST /employee section to expand it.
1. Click the Try it Out button on the right and click the Execute button. This request was processed by the API and resulted in the addition of a record to the employee database table. 
1. To confirm it, scroll down the documentation page, and expand the GET /employee section.
1. Click the Try It Out button, and click the Execute button. The response should show the list of employees (currently only one) retrieved by the API from the database.

