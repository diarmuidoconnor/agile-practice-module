## Building Docker Images.

#### Please note thst you must submit this lab work to Moodle for assessment. See final section for instructions. You must type the exact Git commands provided during the lab as they form the basis for assessment.


So far, we have been using public images in our containers. In this lab, we want to create custom Docker images, run them as part of a multi-container application, and publish them in a registry so others can access them.

### Prerequisites.

To complete this lab, you will need an account with the Docker Hub service. When creating it:
1. Use your SETU email address.
1. Choose a username that includes your name, e.g. Diarmuid O Connor --> Suitable Username = doconnor, diaoconnor, doconnor24, etc.

An account can be created [here][hub].

###  The application.

The application is comprised of three components/containers:

1. The MongoDB server.
1. The Mongo-express web app.
1. A custom web app - we will build an image of this.

Clone the third component's source code from [this repository][repo], and import it into VS Code. In your GitHub account, create a repository called `profile-app`. In VS Code, link the app to your new repository:
~~~
$ git remote remove origin
$ git remote add origin [your-new-repo-url]
$ git push origin main
~~~

Start containers for the first two components of the application:
~~~bash
$ docker run -d  \
    --name mongoDB  \
    -p 27017:27017 \
    -e MONGO_INITDB_ROOT_USERNAME=admin \
    -e MONGO_INITDB_ROOT_PASSWORD=secret \
 mongo:8.0-rc
~~~
and
~~~bash
$ docker run -d  \
      --name mongo-express  \
      -p 8081:8081 \
      -e ME_CONFIG_MONGODB_ADMINUSERNAME=admin \
      -e ME_CONFIG_MONGODB_ADMINPASSWORD=secret \
      -e ME_CONFIG_MONGODB_SERVER=mongodb   \
    mongo-express:1.0-20-alpine3.19
~~~

Open a browser tab at http://localhost:8081/, and use the mongo-express app to create a new database called `user-account`.

Returning to our custom web app in VS Code. It's a simple server-side rendering web app for updating the user-account database managed by our MongoDB server. Create a file in the `app` folder called `.env` with the following content:
~~~
MONGO_USER='admin' 
MONGO_PASS='secret' 
MONGO_HOST='localhost'
MONGO_PORT=27017 
APP_HOST='localhost'
PORT=3000
~~~
The app connects to a MongoDB server on localhost:27017, which matches our MongoDB container because it is using port mapping (-p 27017:27017). The app server will receive requests at localhost:3000. For now, we will run this application outside Docker, but in a later lab, we will “dockerize” it. In VS Code, open an integrated terminal and type the commands:
~~~bash
$ npm  install
$ cd app
$ node server.js
~~~
Complete this sequence in the browser:
1. Open a new browser tab at http://localhost:3000/.
1. Click the Add/Edit Profile button.
1. In the web form, enter your name, email address, and list of interests, and then click the Update Profile button.

This sequence causes the app to write a document (record) to a table named users in our user-account database - the table is auto-created. To confirm this, switch to the Mongo Express browser tab, click the View button beside the user-account database, and then click the View button beside the users collection name (a collection in MongoDB is similar to a table in a relational database). The page shows the details of the user profile you entered on the web form.



[hub]: https://hub.docker.com/
[hub]: https://github.com/diarmuidoconnor/simple-profile-app