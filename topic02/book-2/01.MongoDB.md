
## MongoDB Server deployment.

We must create a persistent volume and a persistent volume claim before deploying the database server. In `multi-component-app`, create the file `pvc.yaml`:
~~~
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mongo-pvc-sc
spec:
  accessModes:
 - ReadWriteMany
  resources:
    requests:
      storage: 50M
  storageClassName: "nfs-client"
~~~
This claim is for 50 megabytes of storage on the networked file system linked to the cluster (storageClassName: "nfs-client"). Request the cluster to create this resource:
~~~
❯ oc apply  -f pvc.yaml -n [your-namespace]
❯ oc get persistentvolumeclaims -n [your-namespace]                         
~~~
The apply command creates the persistent volume as well as the persistent volume claim. Notice in the response to the get command above, under the Volume column is the name of the volume. Volumes are not namespac-scoped.  To list all the volumes currently managed by the cluster:
~~~
$ oc get persistentvolumes                   
~~~
Look under the Claim for your namespace name.

Commit this work:
~~~
$ git add -A
$ git commit -m "Creating PVC  for database."
~~~

We can now create a database server pod. Add a deployment manifest for the database server to the `multi-component-app` folder, called `mongo-deployment.yaml`:
~~~
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mongo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mongo
  template:
    metadata:
      labels:
        app: mongo
    spec:
      serviceAccountName: mongodb-sa
      containers:
      - image: bitnami/mongodb:latest
        name: mongo
        env:
        - name: MONGODB_ROOT_PASSWORD
          value: "secret"
        - name: MONGODB_ROOT_USER
          value: "admin"
        ports:
        - containerPort: 27017
        volumeMounts:
        - mountPath: /bitnami/mongodb  # /data/db
          name: mongo-volume
      volumes:
      - name: mongo-volume
        persistentVolumeClaim:
          claimName: mongo-pvc-sc
~~~ 
